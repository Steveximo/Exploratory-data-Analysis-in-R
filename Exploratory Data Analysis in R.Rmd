---
title: "EXPLORATORY DATA ANALYSIS IN R"
output: prettydoc::html_pretty
date: 'By: Kikonyogo Steven'
editor_options: 
  markdown: 
    wrap: 72
---

## ABOUT THE DATA

This is an excerpt of data from gapminder package on life expectancy,
GDP-percapita, Continent and population by Country by five year-interval
group from 1952 t0 2007.

# AIM OF THE PROJECT

The aim is to explore, analyze and draw meaningful insights from the
data through;

-- Data transformation

-- Data wrangling

-- Data manipulation

-- Data Visualization

-- Correlation and Regression

-- Hypothesis testing against a claim

**(i) Loading required packages**

```{r setup, include=TRUE}
if(!require(pacman)) install.packages("pacman")
pacman::p_load(
              gt,
              car,
              dplyr,
              ggplot2,
              magrittr,
              janitor,
              flextable
              )
              
```

**(ii) A glimpse about the data**

```{r}
df <- gapminder::gapminder
      dim(df)
      head(df, 5)
      summary(df)
      str(df)
      unique(df$continent)
      unique(df$year)
      any(is.na(df))
```

-   *The are 1704 observations and 6 variables, 5 continents, 142
    countries.The min GDP-percapita is \$242 and max \$113523.The min
    life expectancy is 23.6yrs and max 82yrs.*

**(iii) Wrangling, Transformation and Manipulation**

```{r}
df1 <- df %>%
    mutate(gdp_status=case_when(
    gdpPercap < 1000 ~"lower income",
    gdpPercap >=1000 & gdpPercap < 4000 ~ "lower middle income",
    gdpPercap >= 4000 & gdpPercap < 12000 ~ "upper middle income",
    TRUE ~ "high income"))
    tabyl(df1$gdp_status)
    

  high_life <- df1 %>% 
  select(country, 
         year,
         lifeExp,
         continent) %>%
  rename(High_life_Exp2007 = lifeExp) %>%
  filter(year ==2007) %>% 
  arrange(desc(High_life_Exp2007)) 
  
  gt(head(high_life,10))
 
   
   low_gdp <-  df1 %>% 
  select(country, 
         year,
         gdpPercap,
         continent) %>%
  rename(low_gdp_2002 = gdpPercap) %>% 
  filter(year ==2002) %>% 
  arrange(low_gdp_2002)  
  gt(head(low_gdp,10))

```

```{r}
df1%>% 
  select(country, 
         year, 
         continent, 
         gdpPercap) %>%
  filter(year ==2002 & continent =='Africa' & gdpPercap >5000) %>% 
  arrange(desc(gdpPercap)) 

  
df2 <- df %>% 
  select(continent, 
         year, 
         lifeExp) %>%
  filter(year==2002) %>% 
  group_by(continent) %>%
  summarise(meanlife_exp=mean(lifeExp)) %>% 
  arrange(desc(meanlife_exp)) 
  flextable(print(df2,10))
```

```{r}
data1 <-df %>% 
  select(continent,
         year,
         pop, 
         country) %>% 
  group_by(continent) %>% 
  filter(year==1997) %>% 
  summarise(total_pop=sum(pop),
            countries=n_distinct(country)) %>% 
  arrange(desc(total_pop))
  flextable(data1)
  


Avg_pop <- data1 %>% 
  select(continent,
         total_pop,
         countries) %>% 
  mutate(avg_pop_per_cntry=total_pop/countries) 
  flextable(Avg_pop)
  

```

```{r}
df3<- df %>% 
  filter(continent=="Asia" & year>1990 & year<=2000) %>% 
  summarise(Avglife.exp=mean(lifeExp),
            Avgpop=mean(pop),
            Avggdp= mean(gdpPercap))  
  flextable(df3)


data2 <- df1 %>% 
  select( continent, 
          pop, 
          lifeExp ) %>% 
  group_by(continent) %>% 
  summarise(Total_pop=sum(pop),
            avglife= mean(lifeExp)) %>%  
  arrange(desc(avglife)) 
  flextable(data2)
  

  data3 <- df %>% 
    group_by(year, 
             continent) %>% 
    summarise(Year_avg.mean=mean(lifeExp),
              Year_pop=sum(pop)) 
    gt(head(data3,n=10))
 

```

-   *Majority of countries were middle income countries(33%) . From
    Asia, Japan had the highest life Expectancy in 2007(82.6yrs).From
    Africa, DRC had the lowest GDP-percapita in 2002(\$241).Oceania has
    the smallest (2 countries), Americas had 25 countries, Europe had 30
    countries, Asia had 33 countries and Africa had the majority(52
    countries).*

-   *From Africa in 2002, only 9 countries had a GDP-percapita \> \$5000
    with Gabon having the highest(\$12522) and lowest
    Algeria(\$5288).Among continents, Oceania had the highest mean life
    expectancy(79.4yrs) while Africa had the lowest(53.3yrs).The
    continent with the highest population wa Asia with average
    population per country being 102, 523,803 people while Oceania had
    the lowest population with average population per country
    11,120,715.*

-   *Between 1990 and 2000, Asia's mean life expectancy and
    GDP-percapita was 67.2yrs and \$9,236.9 respectively.*

-   *Among all continents, Asia had the highest total population and
    Oceania the lowest.On average, Oceania had the highest total life
    expectancy(74.3yrs)while Africa had the lowest(48.9yrs)*

**Visualization, Hypothesis testing, Correlation and Regression**

```{r}
# Visualization of data spread between countries
data4 <- df %>% 
  select(!c(continent,
            year, 
            pop, 
            gdpPercap)) %>% 
  subset(country=="Burundi"|country=="Uganda") 
  
data4 %>% 
  group_by(country) %>% 
  ggplot(data=data4,
         mapping=aes(x=country, 
                     y=lifeExp, 
                     col=country,
                     fill=country))+
  geom_boxplot(alpha=0.5,
               show.legend = FALSE)+
  labs(title="BOX PLOT OF LIFE EXPECTANCY BY COUNTRY", 
       x="Country", 
       y="Life Expectancy")

# Test for equality of Variances
leveneTest(data4$lifeExp~data4$country)

# Sample t-test for testing equality of means between two groups
# H0: The means of two groups are equal
t.test(data=data4,
       lifeExp~country, 
       alternative='two.sided',               
       conf.level=0.95,
       var.eq=TRUE, 
       paired= FALSE)

data5 <- df %>% 
  select(!c(country,
            year,
            lifeExp)) %>% 
  subset(continent=="Europe"|continent=="Asia") 
  print(data5)

  ggplot(data=data5,
         mapping=aes(x=continent,
                     y=gdpPercap, 
                     col=continent, 
                     fill =continent))+
  geom_boxplot(alpha=0.5,
               show.legend = FALSE)+
  labs(title="BOX PLOT OF GDP-PER CONTINENT", 
       x="Continent", 
       y="GDP-percapita")


leveneTest(data5$gdpPercap~data5$continent)
t.test(data=data5,
       gdpPercap~data5$continent, 
       alternative='two.sided', 
       conf.level=0.95,
       var.eq=TRUE, 
       paired= FALSE)


data6<- df%>% 
  select(!c(country,
            year,
            gdpPercap)) %>% 
  subset(continent=="Europe"|continent=="Asia") 
  print(data6)

ggplot(data=data6,
       mapping=aes(x=continent, 
                   y=lifeExp, 
                   col=continent, 
                   fill=continent))+
  geom_boxplot(alpha=0.5,
               show.legend = FALSE)+
  labs(title="BOX PLOT OF LIFE EXPECTANCY CONTINENT", 
       x="Continent", 
       y="Life expectancy")

leveneTest(data6$lifeExp~data6$continent)

#H0: The mean life expectancy of Asia is greater than Europe
t.test(data=data6,
       lifeExp~continent, 
       alternative='greater', 
       conf.level=0.95,
       var.eq=FALSE, 
       paired= FALSE)

df1 %>% 
  ggplot(mapping=aes(x=continent, 
                     y=lifeExp, 
                     col=continent, 
                     fill=continent))+
  geom_boxplot(alpha=0.5,
               show.legend = FALSE)+
  labs(title="BOX PLOT OF LIFE EXPECTANCY BY CONTINENT", 
       x="Continent", 
       y="Life Expectancy")

# Testing for difference in mean between more than two groups
 ANOVA1 <- aov(lifeExp~continent, 
               data=df1)
 
 # Undestanding where diffences lie
 summary(ANOVA1)
 TukeyHSD(ANOVA1)
 
 df1%>% 
   ggplot(mapping=aes(x=continent, 
                      y=gdpPercap, 
                      col=continent))+
   geom_boxplot(alpha=0.5,
                show.legend = FALSE)+
   labs(title="BOX PLOT OF GDP-PERCAPITA BY CONTINENT",
        x="Continent", 
        y="GDP-percapita")
  
 ANOVA2 <- aov(gdpPercap~continent, 
               data=df1) 
 summary(ANOVA2)
 TukeyHSD(ANOVA2)
 
 # Testing for difference in means in categoricals
 gdp_status <-df%>% 
   mutate(GDP_status = ifelse(gdpPercap>5000,"high_gdp", 
                              "low_gdp"), 
  life_exp_status = ifelse(lifeExp>60,"high_life.exp", 
                           "low_life.exp"))

 tabyl(gdp_status$GDP_status)
 
 
 
  TAB <-  table(gdp_status$life_exp_status,
                gdp_status$GDP_status)
  barplot(TAB,beside=T, 
          legend.text = c('High life expectancy',
                          'low life expectancy'),
          main = 'GDP status VS Life expectancy status',
          xlab='GDP status', 
          col=c(2,4))

  chisq.test(TAB, 
             correct=TRUE)
  
  # Undestanding distribution of data
  hist(df1$lifeExp, 
       breaks = 10, 
       xlim=c(30,90), 
       col='light blue',
       main  ='Histogram for Life Expectancy',
       xlab='Life expectancy')
  hist(log(df1$gdpPercap))
  
  ggplot(data=df1,
         mapping=aes(x=lifeExp,
                     y=log(gdpPercap)))+
      geom_point(col='green', 
                 size=2)+
      geom_smooth(method='lm',
                  col= 'blue')+
    labs(title="Scatterplot:Life Expectancy Vs GDP-percapita",
         x="Life expetancy", 
        y="GDP-percapita")
      
  # Correlation and regression
  df %>% 
    filter(gdpPercap < 5000) %>% 
    ggplot(aes(x=gdpPercap, 
               y=lifeExp, 
               col=continent))+
    geom_point(alpha=0.3)+
    geom_smooth(method=lm)+
    facet_wrap(~continent)
  
cor(df$lifeExp,
    df$gdpPercap, 
    method = 'pearson')
lm(df$lifeExp ~ df$gdpPercap)
summary(lm(df$lifeExp ~ df$gdpPercap))
  


            
              
  
  
```

-   *There is no significant difference in mean life expectancy between
    Uganda and Burundi(P=0.063).*

-   *There is a significant difference in mean GDP-percapita between
    Asia and Europe(P\<0.05)*

-   *-here is no significant evidence to show that the life expectancy
    of Asia is greater than Europe(P=0.9)*

-   *There is a significant difference in mean life expectancy
    continents(P\<0.05).Pair-wise comparisons showed significant
    difference for the 9 pairs except between Oceania and
    Europe(P=0.72).*

-   *There is a significant difference in mean GDP-percapita between
    continents(P\<0.05).Pair-wise comparisons showed significant
    difference for the 8 pairs except Oceania-Europe(P=0.15) and
    Asia-America(P=0.78).*

-   *There is a significant difference between GDP-percapital status
    levels and Life expectancy levels(p\<0.05).*

-   *There is a moderate positive correlation between GDP-percapita and
    life expectancy(r=0.58).*

-   *The regression model is: Life exp=53.96+0.008GDP-percapita. The
    model can predict up to 34%.*
